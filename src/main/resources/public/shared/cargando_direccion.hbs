
<div class="mb-3">
<h5 style="margin-top: 20px">Direccion de Partida</h5>
<div style="width:66%; display: inline-block;">
  <a>Calle</a>
  <input type="text" class="form-control" name="partida-calle" placeholder="" required>
</div>
<div style="width:30%; display: inline-block;margin-left:3%;">
     <a>Altura</a>
    <input type="number" class="form-control"name="partida-altura" placeholder="" required>
</div>
<div>
  <div style="width:48%; display: inline-block;">
      <label for="partida-provincia">Selecciona la provincia:</label>
      <select class="custom-select" name="partida-provincia" id="partida-provincia" style="width:100%;"
              onchange="getMunicipiosProvincia('partida-provincia', 'partida-municipio', 'partida-localidad')"
              required>
          <option value="" disabled selected>--Seleccione una provincia--</option>
          {{#each provincias}}
              <option value="{{id}}" >{{descripcion}}</option>
          {{/each}}
      </select>

  </div>
  <div style="width:48%; display: inline-block; margin-left: 3%;">
      <label for="partida-municipio">Selecciona el municipio:</label>
      <select class="custom-select" name="partida-municipio" id = "partida-municipio" style="width:100%;"
              onchange="getLocalidadesMunicipio('partida-municipio','partida-localidad')" required disabled>
          <option value="" disabled selected>--Seleccione una municipio--</option>
      </select>
  </div>
</div>
<div style="width:48%; display: inline-block; ">
    <label for="partida-localidad">Selecciona la localidad:</label>
    <select class="custom-select" name="partida-localidad" id="partida-localidad" style="width:100%;" required disabled>
        <option value="" disabled selected>--Seleccione una localidad--</option>
    </select>
</div>

{{#block "cargar_direcciones"}}
{{/block}}

<div class="mb-3">
    <h5 style="margin-top: 20px">Direccion de Destino</h5>
    <div style="width:66%; display: inline-block;">
        <a>Calle</a>
        <input type="text" class="form-control" name="destino-calle" placeholder="Ingrese la calle" required>
    </div>
    <div style="width:30%; display: inline-block; margin-left:3%;">
        <a>Altura</a>
        <input type="number" class="form-control" name="destino-altura" placeholder="Ingrese la altura" required>
    </div>
    <div>
        <div style="width:48%; display: inline-block;">
            <label for="partida-provincia">Selecciona la provincia:</label>
            <select class="custom-select" name="destino-provincia" id="destino-provincia" style="width:100%;"
                    onchange="getMunicipiosProvincia('destino-provincia', 'destino-municipio', 'destino-localidad')"
                    required>
                <option value="" disabled selected>--Seleccione una provincia--</option>
                {{#each provincias}}
                    <option value="{{id}}" >{{descripcion}}</option>
                {{/each}}
            </select>
        </div>
        <div style="width:48%; display: inline-block; margin-left:3%;">
            <label for="partida-municipio">Selecciona el municipio:</label>
            <select class="custom-select" name="destino-municipio" id="destino-municipio" style="width:100%;"
                    onchange="getLocalidadesMunicipio('destino-municipio','destino-localidad')" required disabled>
                <option value="" disabled selected>--Seleccione un municipio--</option>
            </select>
        </div>
    </div>
    <div style="width:48%; display: inline-block; ">
        <label for="partida-localidad">Selecciona la localidad:</label>
        <select class="custom-select" name="destino-localidad" id="destino-localidad" required disabled>
            <option value="" disabled selected>--Seleccione una localidad--</option>
        </select>
    </div>
</div>
</div>

<script>

    function resetearOpciones(selectElement, textoPorDefecto){
        selectElement.innerHTML = "";
        let opt1 = document.createElement("option");
        opt1.text = textoPorDefecto;
        opt1.value = "";
        opt1.disabled = true;
        opt1.selected = true;
        selectElement.appendChild(opt1);
    }

    function agregarASelect(selectElement, arr){
        for(let i = 0; i < arr.length; i++)
        {
            var opt = document.createElement("option");
            opt.value = arr[i].id;
            opt.text = arr[i].descripcion;
            selectElement.appendChild(opt);
        }
    }

    //Usamos los parámetros para reutilizar la función en partida y destino
    async function getMunicipiosProvincia(idSelectProvincia, idSelectMunicipio, idSelectLocalidad){
        let idProvincia = document.getElementById(idSelectProvincia).value;
        let selectMunicipio = document.getElementById(idSelectMunicipio);
        let selectLocalidad = document.getElementById(idSelectLocalidad);
        selectMunicipio.disabled = false;

        let municipios = [];

        await fetch('http://localhost:9000/utilidades/municipios/' + idProvincia, {
                    method: 'GET'
                }
            ).then(response => response.json())
             .then(json => municipios = json);

        // vaciamos el select
        // establecemos el predeterminado
        resetearOpciones(selectMunicipio, "--Seleccione un municipio--");
        resetearOpciones(selectLocalidad, "--Seleccione una localidad--");
        selectLocalidad.disabled = true;
        //Llenar:
        agregarASelect(selectMunicipio, municipios);
    }

    async function getLocalidadesMunicipio(idSelectMunicipio, idSelectLocalidad){
        let idMunicipio = document.getElementById(idSelectMunicipio).value;
        let selectLocalidad = document.getElementById(idSelectLocalidad);
        selectLocalidad.disabled = false;

        let localidades = [];

        await fetch('http://localhost:9000/utilidades/localidades/' + idMunicipio, {
                    method: 'GET'
                }
        ).then(response => response.json())
                .then(json => localidades = json);

        // vaciamos el select
        selectLocalidad.innerHTML = "";
        // establecemos el predeterminado
        resetearOpciones(selectLocalidad, "--Seleccione una localidad--");
        //Llenar:
        agregarASelect(selectLocalidad, localidades);
        selectLocalidad.required = localidades.length > 0;
    }
</script>